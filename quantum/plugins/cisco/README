 L2 Network Plugin Framework
============================

*** Reference implementation of plugin framework for L2 network ***
*** Multi-switch (devices and types) capability ***   
*** Support for UCS (blade servers) with M81KR VIC (Palo) for 802.1Qbh ***
*** Support for Nexus 7000 ***

** Pre-requisities
* UCS B200 series blades with M81KR VIC installed.
* UCSM 2.0 (Capitola) Build 230
* RHEL 6.1 (Currently UCS support is only on RHEL, Ubuntu will be supporting in upcoming releases)
* UCS & VIC installation (support for KVM)
* OpenStack Cactus release installation (patch is required, details follow in this document)
* Package python-configobj-4.6.0-3.el6.noarch
* If you have a Nexus switch in your topology and decide to turn on Nexus support, you will need:
	- ncclcient v0.3.1 - Python library for NETCONF clients (http://schmizz.net/ncclient/).
	- paramiko library (do: yum install python-paramiko.noarch)
* To run Quantum on RHEL, you will need to have the correct version of python-routes (version 1.12.3 or later). The RHEL 6.1 package contains an older version. Do the following and check your python-routes version:
rpm -qav | grep "python-routes"

If it's an older version, you will need to upgrade to 1.12.3 or later. One quick way to do it as by adding the following to your /etc/yum.repos.d/openstack.repo (assuming that you had installed OpenStack on this host, and hence had this repo; else you could add to any other operational repo config), and then update the python-routes package. That should get you the python-routes-1.12.3-2.el6.noarch package.

[openstack-deps]
name=OpenStack Nova Compute Dependencies
baseurl=http://yum.griddynamics.net/yum/cactus/deps
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-OPENSTACK


** Plugin Installation Instructions:
* Make a backup copy of quantum/quantum/plugins.ini, and edit the "provider" entry to point to the L2Network-plugin:
provider = quantum.plugins.cisco.l2network_plugin.L2Network

* All configuration files are located under quantum/plugins/cisco/conf. Wherever you find <put_something_here> kind of placeholder, please replace it entirely with the relevant values (don't forget to remove the angle brackets as well) 

* If you are not running Quantum on the same host as the OpenStack Cloud Controller, you will need to change the db_ip_address configuration in nova.ini

* If you want to turn on Nexus support, please uncomment the nexus_plugin property in the plugins.ini file, and enter the relevant configuration in the nexus.ini file. In addition, you will require a patch to the ncclient library. Also make sure that the switch's host key is known to the host on which you are running the Quantum service (since the connection to the switch is over ssh). If you are not turning the Nexus support on, your Nexus configuration will be ignored.

* Check again if you have gone through every conf file and made the required changes (check if all IP addresses are correct, and check if you have entered the credentials correponding to each of those IP addresses in the credentials.ini file).
                    	
* Start the Quantum service

** Additional installation required on Nova Compute:
* Create DB Table in Nova DB (On the Cloud Controller)
mysql -uroot -p<mysql_password_here> nova -e 'create table ports (port_id VARCHAR(255) primary key, profile_name VARCHAR(255), dynamic_vnic VARCHAR(255), host VARCHAR(255), instance_name VARCHAR(255), instance_nic_name VARCHAR(255), used tinyint(1));'

* Replace the following file with the files from the Cisco OpenStack Cactus patch:
/usr/lib/python2.6/site-packages/nova/virt/libvirt_conn.py

* Add the following file from the Cisco OpenStack Cactus patch to your installation:
/usr/lib/python2.6/site-packages/nova/virt/cisco_ucs.py

* Restart nova-compute service

* Note that the requirement for the above patch is temporary and will go away with the integration with OpenStack Diablo. A 802.1Qbh-specific VIF driver will be made available as per the specification here:
http://wiki.openstack.org/network-refactoring#VIF_driver

** Testing
* The unit tests are located at quantum/plugins/cisco/tests/unit. They are executed from quantum/plugins/cisco/ using the run_tests.py script.

* Execution of the run_tests.py script:
    + Testing the core API (without UCS/Nexus/RHEL hardware, can be run on Ubuntu)
	- Disable all device-specific plugins by commenting the entries in the quantum/plugins/cisco/conf/plugins.ini configuration file.
	$> python run_tests.py unit.test_l2networkApi
    + Specific Plugin unit test (needs environment setup as indicated in the pre-requisites)
        - python run_tests.py unit.<name_of_the file>
	e.g.
        $> python run_tests.py unit.test_ucs_plugin.py
    + All unit tests (needs environment setup as indicated in the pre-requisites)
        $> python run_tests.py unit
